{% extends 'car/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container py-4">

  <!-- Gallery -->
  <div id="carDetailCarousel"
       class="carousel slide rounded shadow overflow-hidden"
       data-bs-ride="carousel"
       data-bs-interval="4500"
       data-bs-pause="hover"
       data-bs-touch="true">

    <div class="carousel-inner">
      {% for image in car.images.all %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="kb-frame {% if forloop.counter0|divisibleby:2 %}kb-in{% else %}kb-out{% endif %}">
          <img src="{{ image.image.url }}"
               class="d-block w-100"
               alt="{{ car.year }} {{ car.make }} {{ car.model }} - Photo {{ forloop.counter }}"
               loading="lazy">
        </div>
      </div>
      {% empty %}
      <div class="carousel-item active">
        <div class="kb-frame kb-in">
          <img src="{% static 'images/default-car.jpg' %}"
               class="d-block w-100"
               alt="Default vehicle"
               loading="lazy">
        </div>
      </div>
      {% endfor %}
    </div>

    {% if car.images.count > 1 %}
    <button class="carousel-control-prev" type="button" data-bs-target="#carDetailCarousel" data-bs-slide="prev" aria-label="Previous">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carDetailCarousel" data-bs-slide="next" aria-label="Next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>
    {% endif %}
  </div>

  <!-- Write-up / details BELOW the images -->
  <div class="card mt-4 border-0 shadow-sm">
    <div class="card-body">
      <h1 class="h4 fw-bold mb-1">{{ car.year }} {{ car.make }} {{ car.model }}</h1>
      <div class="mb-3">
        <span class="h5 text-primary fw-bold">â‚¦{{ car.price|floatformat:"0"|intcomma }}</span>
        {% if car.sold %}
          <span class="badge bg-danger ms-2">SOLD</span>
        {% else %}
          <span class="badge bg-success ms-2">AVAILABLE</span>
        {% endif %}
        <span class="badge bg-info ms-1">{{ car.get_condition_display }}</span>
      </div>

      <ul class="list-inline text-muted small mb-3">
        <li class="list-inline-item me-3"><i class="fas fa-tachometer-alt me-1"></i> {{ car.mileage|default:"N/A" }} km</li>
        <li class="list-inline-item me-3"><i class="fas fa-cog me-1"></i> {{ car.get_transmission_display }}</li>
        <li class="list-inline-item"><i class="fas fa-calendar me-1"></i> {{ car.date_added|date:"M d, Y" }}</li>
      </ul>

      <p class="mb-0">{{ car.description|default:"No description available." }}</p>
    </div>
  </div>

</div>

<!-- Floating WhatsApp button (replace number!) -->
<a href="https://wa.me/2348012345678?text=Hello%2C%20I%E2%80%99m%20interested%20in%20the%20{{ car.year }}%20{{ car.make }}%20{{ car.model }}."
   class="whatsapp-fab"
   target="_blank"
   aria-label="Chat on WhatsApp about {{ car.year }} {{ car.make }} {{ car.model }}">
  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M20 4A10 10 0 0 0 3.7 17.1L3 21l3.9-1A10 10 0 1 0 20 4Zm-8 16a8 8 0 0 1-4.09-1.1l-.29-.18-2.59.87.88-2.51-.19-.3A8 8 0 1 1 12 20Zm4.29-5.24c-.23-.11-1.37-.68-1.59-.76s-.37-.12-.53.11-.6.76-.75.91-.27.18-.5.06c-.24-.12-1-.36-1.89-1.16a5.49 5.49 0 0 1-1.31-1.62c-.14-.25-.01-.37.1-.48l.35-.41c.1-.13.16-.23.23-.39s.04-.29-.02-.41-.53-1.27-.72-1.74-.38-.4-.53-.41h-.45c-.16 0-.41.06-.63.29s-.82.8-.82 1.96  .84 2.28.96 2.44  c.12.16 1.66 2.53 4.03 3.55.56.24 1 .39 1.34.49.56.18 1.07.15 1.48.09.45-.07 1.38-.56 1.57-1.11.2-.54.2-1 .14-1.11s-.21-.16-.45-.27Z"/>
  </svg>
  <span>Chat on WhatsApp</span>
</a>

<style>
/* Gallery frame height */
.kb-frame { height: 360px; overflow: hidden; }
.kb-frame img { width: 100%; height: 100%; object-fit: cover; }

/* Ken Burns zoom */
.carousel-item .kb-in img { animation: kbIn 4.5s ease-in-out forwards; }
.carousel-item .kb-out img { animation: kbOut 4.5s ease-in-out forwards; }

@keyframes kbIn   { from { transform: scale(1);   } to { transform: scale(1.08); } }
@keyframes kbOut  { from { transform: scale(1.08);} to { transform: scale(1.00); } }

@media (min-width: 768px) { .kb-frame { height: 480px; } }

/* Floating WhatsApp button */
.whatsapp-fab {
  position: fixed; bottom: 18px; right: 18px;
  display: inline-flex; align-items: center; gap: 8px;
  background: #25D366; color: #fff; text-decoration: none;
  padding: 12px 16px; border-radius: 999px; font-weight: 700;
  box-shadow: 0 10px 25px rgba(37,211,102,.3);
  z-index: 1055; /* above everything */
}
.whatsapp-fab:hover { background: #1ebe5a; color: #fff; }
</style>

<!-- If your base doesn't already include it, ensure Bootstrap JS is loaded -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
